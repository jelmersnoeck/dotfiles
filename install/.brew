# !/bin/bash

# Make sure our ssh configuration is set up correctly
if [ ! -d "$HOME/.ssh" ]; then
    echo "Install your ssh credentials first"
    exit
else
    chmod 0600 ~/.ssh/config
    chmod 0600 ~/.ssh/id_rsa
    ssh-add -K ~/.ssh/id_rsa
fi

# Sudo user
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# Install homebrew if it isn't installed already
brew --version || /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

# Update homebrew
brew update

# Install latests versions
brew upgrade

####################
# Core             #
####################
brew install coreutils
brew install findutils
brew install gnu-sed --with-default-names

####################
# Bash             #
####################

# Install our own bash
brew install bash
brew install bash-completion2

# Switch to using brew-installed bash as default shell
if ! fgrep -q '/usr/local/bin/bash' /etc/shells; then
  echo '/usr/local/bin/bash' | sudo tee -a /etc/shells;
  chsh -s /usr/local/bin/bash;
fi;

####################
# Tools            #
####################

brew install vim --with-override-system-vi
brew install wget --with-iri
brew install grep
brew install ag
brew install watch
brew install certbot
brew install graphviz
brew install dnsmasq

####################
# Go               #
####################
brew install go
brew install dep
go get golang.org/x/tools/cmd/goimports
go get github.com/vektra/mockery/.../
go get github.com/axw/gocov/gocov
go get gopkg.in/matm/v1/gocov-html
go get github.com/golang/lint/golint
go get github.com/kisielk/errcheck
go get github.com/jteeuwen/go-bindata
go get golang.org/x/tools/cmd/present
go get github.com/schachmat/wego
go get github.com/sqs/goreturns
go get -u github.com/cweill/gotests/...
go get -u github.com/rakyll/gotest

####################
# Developer Tools  #
####################
# Git
brew install git
brew install git-lfs
brew install hub
brew install gh

# Bazel
brew tap bazelbuild/tap
brew tap-pin bazelbuild/tap
brew install bazelbuild/tap/bazel

# Protobuf
brew install protobuf
go get -u github.com/golang/protobuf/protoc-gen-go

# Terraform
brew install terraform
brew install packer

# Kubernetes
brew install kubectl
brew install kubectx
brew install kops
brew install octant

# Manifold
brew install manifoldco/brew/manifold-cli
brew install adr-tools

# Tmux + dependencies
brew install tmux
brew install reattach-to-user-namespace
brew install ctags

# Pretty JSON output
brew install jq

# Tree view of a directory
brew install tree

# GPG
brew install gnupg
brew link --overwrite gnupg
brew install pinentry-mac
# keybase pgp export -s | gpg --allow-secret-key-import --import -

# Postgres
brew install postgres
brew services start postgresql

# JavaScript
brew install npm
brew install yarn --without-node

####################
# Config           #
####################

# Vim config
if [ ! -d "$HOME/.vimconfig" ]; then
	git clone https://github.com/jelmersnoeck/vimconfig.git ~/.vimconfig && cd ~/.vimconfig && sh ./install.sh && cd -
fi

# Dotfiles
if [ ! -d "$HOME/.dotfiles" ]; then
	git clone https://github.com/jelmersnoeck/dotfiles.git ~/.dotfiles && cd ~/.dotfiles && sh ./install/install.sh && cd -
	source ~/.bashrc
fi

####################
# Kubernetes       #
####################

curl -sL https://run.linkerd.io/install | sh

brew install kustomize
brew install kubernetes-helm

brew install jsonnet
go get github.com/jsonnet-bundler/jsonnet-bundler/cmd/jb

####################
# Cloud things     #
####################

brew install azure-cli
brew install awscli
brew install getsentry/tools/sentry-cli

brew tap hashicorp/security git@github.com:hashicorp/homebrew-security.git
brew install hashicorp/security/doormat-cli
brew install hashicorp/tap/waypoint

####################
# Desktop Apps     #
####################
brew install brew-cask-completion
brew install --cask google-chrome
brew install --cask google-hangouts
brew install --cask firefox
brew install --cask 1password
brew install --cask dropbox
brew install --cask slack
brew install --cask whatsapp
brew install --cask alfred
brew install --cask docker
brew install --cask sizeup
brew install --cask zoomus
brew install --cask caffeine
brew install --cask virtualbox
brew install --cask minikube
brew install --cask google-cloud-sdk
brew install --cask keybase
brew install --cask iterm2
brew install --cask ngrok
brew install --cask divvy
brew install --cask element
brew install --cask signal
brew install --cask oracle-jdk
brew install --cask 1password-cli
brew install --cask scaleft
brew install --cask brave-browser
